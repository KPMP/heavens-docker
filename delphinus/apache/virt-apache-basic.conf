ServerName localhost
Listen 443

<VirtualHost *:80>

  ServerName kpmp
  ServerAlias localhost
  
  <Directory "/www">
    AuthType basic
    AuthName "Restricted files"
    AuthBasicProvider file
    AuthUserFile "/var/www/.htpasswd"
    Require valid-user
    Header set Cache-Control "no-store, max-age=0, private"
  </Directory>
  
  <Directory "/var/www/html">
    RewriteEngine on
    # LogLevel alert rewrite:trace6

    # Send API calls to the spring container
    RewriteRule	"^/api/(.*)$"	 "http://spring:3030/$1"	[P]

    # Send unspecified/top-level requests to landing page
    RewriteCond %{REQUEST_URI} !^/(dpr|atlas|landing)
    RewriteRule ^(.*)$ /landing/$1
    
    # Serve existing files or directories as requested
    RewriteCond %{REQUEST_FILENAME} -f [OR]
    RewriteCond %{REQUEST_FILENAME} -d
    RewriteRule ^ - [L]

    # Send all non-existant dpr requests to dpr/index.html
    RewriteCond %{REQUEST_URI} /dpr*
    RewriteRule ^ /dpr/index.html [L]
    
    # Send all non-existant atlas requests to atlas/index.html
    RewriteCond %{REQUEST_URI} /atlas*
    RewriteRule ^ /atlas/index.html [L]
  </Directory>
</VirtualHost>
